<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Lwt (lwt.Lwt)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/></head><body><div class="odoc-doc"><a href="../index.html">Up</a><div class="intro"><h1><span class="keyword">Module </span><a href="../#/Lwt">Lwt</a></h1></div><div><div class="doc">Module <code>Lwt</code>: cooperative light-weight threads.</div><div><div class="doc">This module defines <span style="font-style: italic">cooperative light-weight threads</span> with
their primitives. A <span style="font-style: italic">light-weight thread</span> represent a
computation that may be not terminated, for example because it is
waiting for some event to happen.<br/>Lwt threads are cooperative in the sense that switching to another
thread is awlays explicit (with wakeup or wakeup_exn). When a
thread is running, it executes as much as possible, and then
returns (a value or an error) or sleeps.<br/>Note that inside a Lwt thread, exceptions must be raised with
fail instead of <code>raise</code>. Also the <code>try ... with ...</code>
construction will not catch Lwt errors. You must use catch
instead. You can also use wrap for functions that may raise
normal exception.<br/>Lwt also provides the syntax extension Pa_lwt to make code
using Lwt more readable.</div><div class="doc"><h2>Definitions and basics</h2></div><div class="region" id="/t.typ"><a href="#/t.typ" class="anchor"></a><div class="typ"><div class="def"><span class="keyword">type </span>+'a t</div><div class="doc">The type of threads returning a result of type <code>'a</code>.</div></div></div><div class="region" id="/return.val"><a href="#/return.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>return : 'a -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"><code>return e</code> is a thread whose return value is the value of the
expression <code>e</code>.</div></div></div><div class="region" id="/fail.val"><a href="#/fail.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>fail : exn -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"><code>fail e</code> is a thread that fails with the exception <code>e</code>.</div></div></div><div class="region" id="/fail_with.val"><a href="#/fail_with.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>fail_with : string -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"><code>fail_with msg</code> is a thread that fails with the exception
<code>Failure msg</code>.</div></div></div><div class="region" id="/fail_invalid_arg.val"><a href="#/fail_invalid_arg.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>fail_invalid_arg : string -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"><code>fail_invalid_arg msg</code> is a thread that fails with the exception
<code>Invalid_argument msg</code>.</div></div></div><div class="region" id="/bind.val"><a href="#/bind.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>bind : 'a <a href="index.html#/t.typ">t</a> -&gt; ('a -&gt; 'b <a href="index.html#/t.typ">t</a>) -&gt; 'b <a href="index.html#/t.typ">t</a></div><div class="doc"><code>bind t f</code> is a thread which first waits for the thread <code>t</code> to
terminate and then, if the thread succeeds, behaves as the
application of function <code>f</code> to the return value of <code>t</code>. If the
thread <code>t</code> fails, <code>bind t f</code> also fails, with the same
exception.<br/>The expression <code>bind t (fun x -&gt; t')</code> can intuitively be read as
<code>let x = t in t'</code>, and if you use the <span style="font-style: italic">lwt.syntax</span> syntax
extension, you can write a bind operation like that: <code>lwt x = t in t'</code>.<br/>Note that <code>bind</code> is also often used just for synchronization
purpose: <code>t'</code> will not execute before <code>t</code> is terminated.<br/>The result of a thread can be bound several times.<br/>Note that <code>bind</code> will not propagate backtraces correctly.
See &lt;&lt;a_api project=&quot;lwt&quot; | The manual&gt;&gt;
for how to enable backtraces.</div></div></div><div class="region" id="/(&gt;&gt;=).val"><a href="#/(&gt;&gt;=).val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>(&gt;&gt;=) : 'a <a href="index.html#/t.typ">t</a> -&gt; ('a -&gt; 'b <a href="index.html#/t.typ">t</a>) -&gt; 'b <a href="index.html#/t.typ">t</a></div><div class="doc"><code>t &gt;&gt;= f</code> is an alternative notation for <code>bind t f</code>.</div></div></div><div class="region" id="/(=&lt;&lt;).val"><a href="#/(=&lt;&lt;).val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>(=&lt;&lt;) : ('a -&gt; 'b <a href="index.html#/t.typ">t</a>) -&gt; 'a <a href="index.html#/t.typ">t</a> -&gt; 'b <a href="index.html#/t.typ">t</a></div><div class="doc"><code>f =&lt;&lt; t</code> is <code>t &gt;&gt;= f</code></div></div></div><div class="region" id="/map.val"><a href="#/map.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>map : ('a -&gt; 'b) -&gt; 'a <a href="index.html#/t.typ">t</a> -&gt; 'b <a href="index.html#/t.typ">t</a></div><div class="doc"><code>map f m</code> maps the result of a thread. This is the same as <code>bind
      m (fun x -&gt; return (f x))</code></div></div></div><div class="region" id="/(&gt;|=).val"><a href="#/(&gt;|=).val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>(&gt;|=) : 'a <a href="index.html#/t.typ">t</a> -&gt; ('a -&gt; 'b) -&gt; 'b <a href="index.html#/t.typ">t</a></div><div class="doc"><code>m &gt;|= f</code> is <code>map f m</code></div></div></div><div class="region" id="/(=|&lt;).val"><a href="#/(=|&lt;).val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>(=|&lt;) : ('a -&gt; 'b) -&gt; 'a <a href="index.html#/t.typ">t</a> -&gt; 'b <a href="index.html#/t.typ">t</a></div><div class="doc"><code>f =|&lt; m</code> is <code>map f m</code></div></div></div><div class="doc"><h3>Pre-allocated threads</h3></div><div class="region" id="/return_unit.val"><a href="#/return_unit.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>return_unit : unit <a href="index.html#/t.typ">t</a></div><div class="doc"><code>return_unit = return ()</code></div></div></div><div class="region" id="/return_none.val"><a href="#/return_none.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>return_none : 'a option <a href="index.html#/t.typ">t</a></div><div class="doc"><code>return_none = return None</code></div></div></div><div class="region" id="/return_some.val"><a href="#/return_some.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>return_some : 'a -&gt; 'a option <a href="index.html#/t.typ">t</a></div><div class="doc"><code>return_some x = return (Some x)</code></div></div></div><div class="region" id="/return_nil.val"><a href="#/return_nil.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>return_nil : 'a list <a href="index.html#/t.typ">t</a></div><div class="doc"><code>return_nil = return []</code></div></div></div><div class="region" id="/return_true.val"><a href="#/return_true.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>return_true : bool <a href="index.html#/t.typ">t</a></div><div class="doc"><code>return_true = return true</code></div></div></div><div class="region" id="/return_false.val"><a href="#/return_false.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>return_false : bool <a href="index.html#/t.typ">t</a></div><div class="doc"><code>return_false = return false</code></div></div></div><div class="doc"><h2>Thread storage</h2></div><div class="region" id="/key.typ"><a href="#/key.typ" class="anchor"></a><div class="typ"><div class="def"><span class="keyword">type </span>'a key</div><div class="doc">Type of a key. Keys are used to store local values into
threads.</div></div></div><div class="region" id="/new_key.val"><a href="#/new_key.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>new_key : unit -&gt; 'a <a href="index.html#/key.typ">key</a></div><div class="doc"><code>new_key ()</code> creates a new key.</div></div></div><div class="region" id="/get.val"><a href="#/get.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>get : 'a <a href="index.html#/key.typ">key</a> -&gt; 'a option</div><div class="doc"><code>get key</code> returns the value associated with <code>key</code> in the current
thread.</div></div></div><div class="region" id="/with_value.val"><a href="#/with_value.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>with_value : 'a <a href="index.html#/key.typ">key</a> -&gt; 'a option -&gt; (unit -&gt; 'b) -&gt; 'b</div><div class="doc"><code>with_value key value f</code> executes <code>f</code> with <code>value</code> associated to
<code>key</code>. <code>key</code> is restored to its previous value after <code>f</code> terminates.</div></div></div><div class="doc"><h2>Exceptions handling</h2></div><div class="region" id="/catch.val"><a href="#/catch.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>catch : (unit -&gt; 'a <a href="index.html#/t.typ">t</a>) -&gt; (exn -&gt; 'a <a href="index.html#/t.typ">t</a>) -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"><code>catch t f</code> is a thread that behaves as the thread <code>t ()</code> if
this thread succeeds. If the thread <code>t ()</code> fails with some
exception, <code>catch t f</code> behaves as the application of <code>f</code> to this
exception.</div></div></div><div class="region" id="/try_bind.val"><a href="#/try_bind.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>try_bind : (unit -&gt; 'a <a href="index.html#/t.typ">t</a>) -&gt; ('a -&gt; 'b <a href="index.html#/t.typ">t</a>) -&gt; (exn -&gt; 'b <a href="index.html#/t.typ">t</a>) -&gt; 'b <a href="index.html#/t.typ">t</a></div><div class="doc"><code>try_bind t f g</code> behaves as <code>bind (t ()) f</code> if <code>t</code> does not
fail. Otherwise, it behaves as the application of <code>g</code> to the
exception associated to <code>t ()</code>.</div></div></div><div class="region" id="/finalize.val"><a href="#/finalize.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>finalize : (unit -&gt; 'a <a href="index.html#/t.typ">t</a>) -&gt; (unit -&gt; unit <a href="index.html#/t.typ">t</a>) -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"><code>finalize f g</code> returns the same result as <code>f ()</code> whether it
fails or not. In both cases, <code>g ()</code> is executed after <code>f</code>.</div></div></div><div class="region" id="/wrap.val"><a href="#/wrap.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wrap : (unit -&gt; 'a) -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"><code>wrap f</code> calls <code>f</code> and transforms the result into an Lwt thread.
If <code>f</code> raises an exception, it is caught and converted to an Lwt
exception.<br/>This is actually the same as:<br/><pre>
        try
          return (f ())
        with exn -&gt;
          fail exn
      </pre></div></div></div><div class="region" id="/wrap1.val"><a href="#/wrap1.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wrap1 : ('a -&gt; 'b) -&gt; 'a -&gt; 'b <a href="index.html#/t.typ">t</a></div><div class="doc"><code>wrap1 f x</code> applies <code>f</code> on <code>x</code> and returns the result as a
thread. If the application of <code>f</code> to <code>x</code> raise an exception it
is catched and a thread is returned.<br/>Note that you must use wrap instead of wrap1 if the
evaluation of <code>x</code> may raise an exception.<br/>For example, the following code is incorrect:<br/><pre>
        wrap1 f (Hashtbl.find table key)
      </pre><br/>and should be written as:<br/><pre>
        wrap (fun () -&gt; f (Hashtbl.find table key))
      </pre></div></div></div><div class="region" id="/wrap2.val"><a href="#/wrap2.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wrap2 : ('a -&gt; 'b -&gt; 'c) -&gt; 'a -&gt; 'b -&gt; 'c <a href="index.html#/t.typ">t</a></div><div class="doc"></div></div></div><div class="region" id="/wrap3.val"><a href="#/wrap3.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wrap3 : ('a -&gt; 'b -&gt; 'c -&gt; 'd) -&gt; 'a -&gt; 'b -&gt; 'c -&gt; 'd <a href="index.html#/t.typ">t</a></div><div class="doc"></div></div></div><div class="region" id="/wrap4.val"><a href="#/wrap4.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wrap4 : ('a -&gt; 'b -&gt; 'c -&gt; 'd -&gt; 'e) -&gt; 'a -&gt; 'b -&gt; 'c -&gt; 'd -&gt; 'e <a href="index.html#/t.typ">t</a></div><div class="doc"></div></div></div><div class="region" id="/wrap5.val"><a href="#/wrap5.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wrap5 : ('a -&gt; 'b -&gt; 'c -&gt; 'd -&gt; 'e -&gt; 'f) -&gt; 'a -&gt; 'b -&gt; 'c -&gt; 'd -&gt; 'e -&gt; 'f <a href="index.html#/t.typ">t</a></div><div class="doc"></div></div></div><div class="region" id="/wrap6.val"><a href="#/wrap6.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wrap6 : ('a -&gt; 'b -&gt; 'c -&gt; 'd -&gt; 'e -&gt; 'f -&gt; 'g) -&gt; 'a -&gt; 'b -&gt; 'c -&gt; 'd -&gt; 'e -&gt; 'f -&gt; 'g <a href="index.html#/t.typ">t</a></div><div class="doc"></div></div></div><div class="region" id="/wrap7.val"><a href="#/wrap7.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wrap7 : ('a -&gt; 'b -&gt; 'c -&gt; 'd -&gt; 'e -&gt; 'f -&gt; 'g -&gt; 'h) -&gt; 'a -&gt; 'b -&gt; 'c -&gt; 'd -&gt; 'e -&gt; 'f -&gt; 'g -&gt; 'h <a href="index.html#/t.typ">t</a></div><div class="doc"></div></div></div><div class="doc"><h2>Multi-threads composition</h2></div><div class="region" id="/choose.val"><a href="#/choose.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>choose : 'a <a href="index.html#/t.typ">t</a> list -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"><code>choose l</code> behaves as the first thread in <code>l</code> to terminate. If
several threads are already terminated, one is chosen at
random.<br/>Note: choose leaves the local values of the current thread
unchanged.</div></div></div><div class="region" id="/nchoose.val"><a href="#/nchoose.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>nchoose : 'a <a href="index.html#/t.typ">t</a> list -&gt; 'a list <a href="index.html#/t.typ">t</a></div><div class="doc"><code>nchoose l</code> returns the value of all that have succcessfully
terminated. If all threads are sleeping, it waits for at least
one to terminates. If one the threads of <code>l</code> fails, <code>nchoose</code>
fails with the same exception.<br/>Note: nchoose leaves the local values of the current thread
unchanged.</div></div></div><div class="region" id="/nchoose_split.val"><a href="#/nchoose_split.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>nchoose_split : 'a <a href="index.html#/t.typ">t</a> list -&gt; ('a list * 'a <a href="index.html#/t.typ">t</a> list) <a href="index.html#/t.typ">t</a></div><div class="doc"><code>nchoose_split l</code> does the same as nchoose but also retrurns
the list of threads that have not yet terminated.</div></div></div><div class="region" id="/join.val"><a href="#/join.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>join : unit <a href="index.html#/t.typ">t</a> list -&gt; unit <a href="index.html#/t.typ">t</a></div><div class="doc"><code>join l</code> waits for all threads in <code>l</code> to terminate. If one of
the threads fails, then <code>join l</code> will fails with the same
exception as the first one to terminate.<br/>Note: join leaves the local values of the current thread
unchanged.</div></div></div><div class="region" id="/(&lt;?&gt;).val"><a href="#/(&lt;?&gt;).val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>(&lt;?&gt;) : 'a <a href="index.html#/t.typ">t</a> -&gt; 'a <a href="index.html#/t.typ">t</a> -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"><code>t &lt;?&gt; t'</code> is the same as <code>choose [t; t']</code></div></div></div><div class="region" id="/(&lt;&amp;&gt;).val"><a href="#/(&lt;&amp;&gt;).val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>(&lt;&amp;&gt;) : unit <a href="index.html#/t.typ">t</a> -&gt; unit <a href="index.html#/t.typ">t</a> -&gt; unit <a href="index.html#/t.typ">t</a></div><div class="doc"><code>t &lt;&amp;&gt; t'</code> is the same as <code>join [t; t']</code></div></div></div><div class="region" id="/async.val"><a href="#/async.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>async : (unit -&gt; 'a <a href="index.html#/t.typ">t</a>) -&gt; unit</div><div class="doc"><code>async f</code> starts a thread without waiting for the result. If it
fails (now or later), the exception is given to
async_exception_hook.<br/>You should use this function if you want to start a thread that
might fail and don't care what its return value is, nor when it
terminates (for instance, because it is looping).</div></div></div><div class="region" id="/ignore_result.val"><a href="#/ignore_result.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>ignore_result : 'a <a href="index.html#/t.typ">t</a> -&gt; unit</div><div class="doc"><code>ignore_result t</code> is like <code>Pervasives.ignore t</code> except that:<br/><ul><li>if <code>t</code> already failed, it raises the exception now,</li><li>if <code>t</code> is sleeping and fails later, the exception will be
given to async_exception_hook.</li></ul></div></div></div><div class="region" id="/async_exception_hook.val"><a href="#/async_exception_hook.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>async_exception_hook : (exn -&gt; unit) <a href="../../ocaml/Pervasives/index.html#/ref.typ">Pervasives.ref</a></div><div class="doc">Function called when a asynchronous exception is thrown.<br/>The default behavior is to print an error message with a
backtrace if available and to exit the program.<br/>The behavior is undefined if this function raise an
exception.<br/>See &lt;&lt;a_api project=&quot;lwt&quot; | The manual&gt;&gt;
for how to enable backtraces.</div></div></div><div class="doc"><h2>Sleeping and resuming</h2></div><div class="region" id="/u.typ"><a href="#/u.typ" class="anchor"></a><div class="typ"><div class="def"><span class="keyword">type </span>'a u</div><div class="doc">The type of thread wakeners.</div></div></div><div class="region" id="/wait.val"><a href="#/wait.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wait : unit -&gt; 'a <a href="index.html#/t.typ">t</a> * 'a <a href="index.html#/u.typ">u</a></div><div class="doc"><code>wait ()</code> is a pair of a thread which sleeps forever (unless it
is resumed by one of the functions <code>wakeup</code>, <code>wakeup_exn</code> below)
and the corresponding wakener. This thread does not block the
execution of the remainder of the program (except of course, if
another thread tries to wait for its termination).</div></div></div><div class="region" id="/wakeup.val"><a href="#/wakeup.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wakeup : 'a <a href="index.html#/u.typ">u</a> -&gt; 'a -&gt; unit</div><div class="doc"><code>wakeup t e</code> makes the sleeping thread <code>t</code> terminate and return
the value of the expression <code>e</code>.</div></div></div><div class="region" id="/wakeup_exn.val"><a href="#/wakeup_exn.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wakeup_exn : 'a <a href="index.html#/u.typ">u</a> -&gt; exn -&gt; unit</div><div class="doc"><code>wakeup_exn t e</code> makes the sleeping thread <code>t</code> fail with the
exception <code>e</code>.</div></div></div><div class="region" id="/wakeup_later.val"><a href="#/wakeup_later.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wakeup_later : 'a <a href="index.html#/u.typ">u</a> -&gt; 'a -&gt; unit</div><div class="doc">Same as wakeup but it is not guaranteed that the thread will
be woken up immediately.</div></div></div><div class="region" id="/wakeup_later_exn.val"><a href="#/wakeup_later_exn.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wakeup_later_exn : 'a <a href="index.html#/u.typ">u</a> -&gt; exn -&gt; unit</div><div class="doc">Same as wakeup_exn but it is not guaranteed that the thread
will be woken up immediately.</div></div></div><div class="region" id="/waiter_of_wakener.val"><a href="#/waiter_of_wakener.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>waiter_of_wakener : 'a <a href="index.html#/u.typ">u</a> -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc">Returns the thread associated to a wakener.</div></div></div><div class="region" id="/result.typ"><a href="#/result.typ" class="anchor"></a><div class="typ"><div class="def"><span class="keyword">type </span>+'a result</div><div class="doc">Either a value of type <code>'a</code>, either an exception.</div></div></div><div class="region" id="/make_value.val"><a href="#/make_value.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>make_value : 'a -&gt; 'a <a href="index.html#/result.typ">result</a></div><div class="doc"><code>value x</code> creates a result containing the value <code>x</code>.</div></div></div><div class="region" id="/make_error.val"><a href="#/make_error.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>make_error : exn -&gt; 'a <a href="index.html#/result.typ">result</a></div><div class="doc"><code>error e</code> creates a result containing the exception <code>e</code>.</div></div></div><div class="region" id="/of_result.val"><a href="#/of_result.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>of_result : 'a <a href="index.html#/result.typ">result</a> -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc">Returns a thread from a result.</div></div></div><div class="region" id="/wakeup_result.val"><a href="#/wakeup_result.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wakeup_result : 'a <a href="index.html#/u.typ">u</a> -&gt; 'a <a href="index.html#/result.typ">result</a> -&gt; unit</div><div class="doc"><code>wakeup_result t r</code> makes the sleeping thread <code>t</code> terminate with
the result <code>r</code>.</div></div></div><div class="region" id="/wakeup_later_result.val"><a href="#/wakeup_later_result.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wakeup_later_result : 'a <a href="index.html#/u.typ">u</a> -&gt; 'a <a href="index.html#/result.typ">result</a> -&gt; unit</div><div class="doc">Same as wakeup_result but it is not guaranteed that the
thread will be woken up immediately.</div></div></div><div class="doc"><h2>Threads state</h2></div><div class="region" id="/state.typ"><a href="#/state.typ" class="anchor"></a><div class="typ"><div class="def"><span class="keyword">type </span>'a state = <table><tr class="cons"><td><div class="region" id="/state.typ/Return.cons"><a href="#/state.typ/Return.cons" class="anchor"></a>| Return of 'a</div></td><td>(*</td><td><div class="doc">The thread which has successfully terminated</div></td><td>*)</td></tr><tr class="cons"><td><div class="region" id="/state.typ/Fail.cons"><a href="#/state.typ/Fail.cons" class="anchor"></a>| Fail of exn</div></td><td>(*</td><td><div class="doc">The thread raised an exception</div></td><td>*)</td></tr><tr class="cons"><td><div class="region" id="/state.typ/Sleep.cons"><a href="#/state.typ/Sleep.cons" class="anchor"></a>| Sleep</div></td><td>(*</td><td><div class="doc">The thread is sleeping</div></td><td>*)</td></tr></table></div><div class="doc">State of a thread</div></div></div><div class="region" id="/state.val"><a href="#/state.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>state : 'a <a href="index.html#/t.typ">t</a> -&gt; 'a <a href="index.html#/state.typ">state</a></div><div class="doc"><code>state t</code> returns the state of a thread</div></div></div><div class="region" id="/is_sleeping.val"><a href="#/is_sleeping.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>is_sleeping : 'a <a href="index.html#/t.typ">t</a> -&gt; bool</div><div class="doc"><code>is_sleeping t</code> returns <code>true</code> iff <code>t</code> is sleeping.</div></div></div><div class="doc"><h2>Cancelable threads</h2></div><div class="doc">Cancelable threads are the same as regular threads except that
they can be canceled.</div><div class="exn"><div class="def"><span class="keyword">exn </span>Canceled</div><div class="doc">Canceled threads fails with this exception</div></div><div class="region" id="/task.val"><a href="#/task.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>task : unit -&gt; 'a <a href="index.html#/t.typ">t</a> * 'a <a href="index.html#/u.typ">u</a></div><div class="doc"><code>task ()</code> is the same as <code>wait ()</code> except that threads created
with <code>task</code> can be canceled.</div></div></div><div class="region" id="/on_cancel.val"><a href="#/on_cancel.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>on_cancel : 'a <a href="index.html#/t.typ">t</a> -&gt; (unit -&gt; unit) -&gt; unit</div><div class="doc"><code>on_cancel t f</code> executes <code>f</code> when <code>t</code> is canceled. <code>f</code> will be
executed before all other threads waiting on <code>t</code>.<br/>If <code>f</code> raises an exception it is given to
async_exception_hook.</div></div></div><div class="region" id="/add_task_r.val"><a href="#/add_task_r.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>add_task_r : 'a <a href="index.html#/u.typ">u</a> <a href="../Lwt_sequence/index.html#/t.typ">Lwt_sequence.t</a> -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"><code>add_task_r seq</code> creates a sleeping thread, adds its wakener to
the right of <code>seq</code> and returns its waiter. When the thread is
canceled, it is removed from <code>seq</code>.</div></div></div><div class="region" id="/add_task_l.val"><a href="#/add_task_l.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>add_task_l : 'a <a href="index.html#/u.typ">u</a> <a href="../Lwt_sequence/index.html#/t.typ">Lwt_sequence.t</a> -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"><code>add_task_l seq</code> creates a sleeping thread, adds its wakener to
the left of <code>seq</code> and returns its waiter. When the thread is
canceled, it is removed from <code>seq</code>.</div></div></div><div class="region" id="/cancel.val"><a href="#/cancel.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>cancel : 'a <a href="index.html#/t.typ">t</a> -&gt; unit</div><div class="doc"><code>cancel t</code> cancels the threads <code>t</code>. This means that the deepest
sleeping thread created with <code>task</code> and connected to <code>t</code> is
woken up with the exception Canceled.<br/>For example, in the following code:<br/><pre>
        let waiter, wakener = task () in
        cancel (waiter &gt;&gt; printl &quot;plop&quot;)
      </pre><br/><code>waiter</code> will be woken up with Canceled.</div></div></div><div class="region" id="/pick.val"><a href="#/pick.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>pick : 'a <a href="index.html#/t.typ">t</a> list -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"><code>pick l</code> is the same as choose, except that it cancels all
sleeping threads when one terminates.<br/>Note: pick leaves the local values of the current thread
unchanged.</div></div></div><div class="region" id="/npick.val"><a href="#/npick.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>npick : 'a <a href="index.html#/t.typ">t</a> list -&gt; 'a list <a href="index.html#/t.typ">t</a></div><div class="doc"><code>npick l</code> is the same as nchoose, except that it cancels all
sleeping threads when one terminates.<br/>Note: npick leaves the local values of the current thread
unchanged.</div></div></div><div class="region" id="/protected.val"><a href="#/protected.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>protected : 'a <a href="index.html#/t.typ">t</a> -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"><code>protected thread</code> creates a new cancelable thread which behave
as <code>thread</code> except that cancelling it does not cancel
<code>thread</code>.</div></div></div><div class="region" id="/no_cancel.val"><a href="#/no_cancel.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>no_cancel : 'a <a href="index.html#/t.typ">t</a> -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"><code>no_cancel thread</code> creates a thread which behave as <code>thread</code>
except that it cannot be canceled.</div></div></div><div class="doc"><h2>Pause</h2></div><div class="region" id="/pause.val"><a href="#/pause.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>pause : unit -&gt; unit <a href="index.html#/t.typ">t</a></div><div class="doc"><code>pause ()</code> is a sleeping thread which is wake up on the next
call to wakeup_paused. A thread created with <code>pause</code> can be
canceled.</div></div></div><div class="region" id="/wakeup_paused.val"><a href="#/wakeup_paused.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>wakeup_paused : unit -&gt; unit</div><div class="doc"><code>wakeup_paused ()</code> wakes up all threads which suspended
themselves with pause.<br/>This function is called by the scheduler, before entering the
main loop. You usually do not have to call it directly, except
if you are writing a custom scheduler.<br/>Note that if a paused thread resumes and pauses again, it will not
be woken up at this point.</div></div></div><div class="region" id="/paused_count.val"><a href="#/paused_count.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>paused_count : unit -&gt; int</div><div class="doc"><code>paused_count ()</code> returns the number of currently paused
threads.</div></div></div><div class="region" id="/register_pause_notifier.val"><a href="#/register_pause_notifier.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>register_pause_notifier : (int -&gt; unit) -&gt; unit</div><div class="doc"><code>register_pause_notifier f</code> register a function <code>f</code> that will be
called each time pause is called. The parameter passed to <code>f</code> is
the new number of threads paused. It is usefull to be able to
call wakeup_paused when there is no scheduler</div></div></div><div class="doc"><h2>Misc</h2></div><div class="region" id="/on_success.val"><a href="#/on_success.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>on_success : 'a <a href="index.html#/t.typ">t</a> -&gt; ('a -&gt; unit) -&gt; unit</div><div class="doc"><code>on_success t f</code> executes <code>f</code> when <code>t</code> terminates without
failing. If <code>f</code> raises an exception it is given to
async_exception_hook.</div></div></div><div class="region" id="/on_failure.val"><a href="#/on_failure.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>on_failure : 'a <a href="index.html#/t.typ">t</a> -&gt; (exn -&gt; unit) -&gt; unit</div><div class="doc"><code>on_failure t f</code> executes <code>f</code> when <code>t</code> terminates and fails. If
<code>f</code> raises an exception it is given to
async_exception_hook.</div></div></div><div class="region" id="/on_termination.val"><a href="#/on_termination.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>on_termination : 'a <a href="index.html#/t.typ">t</a> -&gt; (unit -&gt; unit) -&gt; unit</div><div class="doc"><code>on_termination t f</code> executes <code>f</code> when <code>t</code> terminates. If <code>f</code>
raises an exception it is given to async_exception_hook.</div></div></div><div class="region" id="/on_any.val"><a href="#/on_any.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>on_any : 'a <a href="index.html#/t.typ">t</a> -&gt; ('a -&gt; unit) -&gt; (exn -&gt; unit) -&gt; unit</div><div class="doc"><code>on_any t f g</code> executes <code>f</code> or <code>g</code> when <code>t</code> terminates. If <code>f</code>
or <code>g</code> raises an exception it is given to
async_exception_hook.</div></div></div><div class="region" id="/Infix"><a href="#/Infix" class="anchor"></a><div class="mod"><div class="def"><span class="keyword">module </span><a href="Infix/index.html">Infix</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></div><div class="doc">Infix operators. You should open only this module.</div></div></div><div class="region" id="/poll.val"><a href="#/poll.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>poll : 'a <a href="index.html#/t.typ">t</a> -&gt; 'a option</div><div class="doc"></div></div></div><div class="region" id="/apply.val"><a href="#/apply.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>apply : ('a -&gt; 'b <a href="index.html#/t.typ">t</a>) -&gt; 'a -&gt; 'b <a href="index.html#/t.typ">t</a></div><div class="doc"></div></div></div><div class="region" id="/backtrace_bind.val"><a href="#/backtrace_bind.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>backtrace_bind : (exn -&gt; exn) -&gt; 'a <a href="index.html#/t.typ">t</a> -&gt; ('a -&gt; 'b <a href="index.html#/t.typ">t</a>) -&gt; 'b <a href="index.html#/t.typ">t</a></div><div class="doc"></div></div></div><div class="region" id="/backtrace_catch.val"><a href="#/backtrace_catch.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>backtrace_catch : (exn -&gt; exn) -&gt; (unit -&gt; 'a <a href="index.html#/t.typ">t</a>) -&gt; (exn -&gt; 'a <a href="index.html#/t.typ">t</a>) -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"></div></div></div><div class="region" id="/backtrace_try_bind.val"><a href="#/backtrace_try_bind.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>backtrace_try_bind : (exn -&gt; exn) -&gt; (unit -&gt; 'a <a href="index.html#/t.typ">t</a>) -&gt; ('a -&gt; 'b <a href="index.html#/t.typ">t</a>) -&gt; (exn -&gt; 'b <a href="index.html#/t.typ">t</a>) -&gt; 'b <a href="index.html#/t.typ">t</a></div><div class="doc"></div></div></div><div class="region" id="/backtrace_finalize.val"><a href="#/backtrace_finalize.val" class="anchor"></a><div class="val"><div class="def"><span class="keyword">val </span>backtrace_finalize : (exn -&gt; exn) -&gt; (unit -&gt; 'a <a href="index.html#/t.typ">t</a>) -&gt; (unit -&gt; unit <a href="index.html#/t.typ">t</a>) -&gt; 'a <a href="index.html#/t.typ">t</a></div><div class="doc"></div></div></div></div></div></div></body></html>